

function getCrmWindow(){return null!==opener?opener.parent:"object"==typeof parent.app&&parent}window.rcmail&&rcmail.addEventListener("init",function(e){var a=window.crm=getCrmWindow();rcmail.env.site_URL;rcmail.env.compose_commands.push("yetiforce.addFilesToMail"),rcmail.env.compose_commands.push("yetiforce.addFilesFromCRM"),rcmail.register_command("yetiforce.addFilesToMail",function(e){var a=(new Date).getTime(),t="rcmupload"+a,i=rcmail.async_upload_form_frame(t);e._uploadid=a,jQuery.ajax({url:"?_task=mail&_action=plugin.yetiforce.addFilesToMail&_id="+rcmail.env.compose_id,type:"POST",data:e,success:function(e){var a=i[0];$(a).html(e)}})},!0),rcmail.register_command("yetiforce.addFilesFromCRM",function(e){0!=a&&window.crm.app.showRecordsList({module:"Documents",src_module:"Documents",multi_select:!0,additionalInformations:!0},(e,a)=>{a.setSelectEvent(e=>{rcmail.command("yetiforce.addFilesToMail",{ids:Object.keys(e),_uploadid:(new Date).getTime()})})})},!0),$("#composeheaders #yt_adress_buttons .button").click(function(){var e=$(this).attr("data-input"),a=$(this).attr("data-module");window.crm.app.showRecordsList({module:a,src_module:"OSSMail",multi_select:!0,additionalInformations:!0},(a,t)=>{t.setSelectEvent((a,t)=>{let i=[];if(void 0!==t.target&&"email"===$(t.target).data("type")?i.push($(t.target).text()):$.each(a,function(e,a){$.each(a,function(e,a){if(("email"===a.type||"multiEmail"===a.type)&&a.value)return i.push(a.value),!1})}),0===i.length)window.crm.Vtiger_Helper_Js.showPnotify({text:window.crm.app.vtranslate("NoFindEmailInRecord"),animation:"show"});else{let a=$("#"+e).val();""!=a&&","!=a.charAt(a.length-1)&&(a+=","),$("#"+e).val(a+i.join(","))}})})}),rcmail.env.isPermittedMailTemplates&&jQuery.ajax({type:"Get",url:"?_task=mail&_action=plugin.yetiforce.getEmailTemplates&_id="+rcmail.env.compose_id,async:!1,success:function(e){var a=[],t=[];e=JSON.parse(e),$.each(e,function(e,a){jQuery("#vtmodulemenulink").removeClass("disabled"),jQuery("#tplmenulink").removeClass("disabled"),t.push({name:a.moduleName,label:a.moduleName}),jQuery("#tplmenu #texttplsmenu").append('<li class="'+a.moduleName+'"><a href="#" data-module="'+a.module+'" data-tplid="'+a.id+'" class="active">'+a.name+"</a></li>")}),$.each(t,function(e,t){-1==jQuery.inArray(t.name,a)&&(jQuery("#vtmodulemenu .toolbarmenu").append('<li class="'+t.name+'"><a href="#" data-module="'+t.name+'" class="active">'+t.label+"</a></li>"),a.push(t.name))})}}),jQuery("#vtmodulemenu li a").on("click",function(){var e=jQuery(this).data("module");void 0==e?jQuery("#tplmenu li").show():(jQuery("#tplmenu li."+e).show(),jQuery("#tplmenu li").not("."+e).hide())}),void 0!=rcmail.env.crmModule&&jQuery("#vtmodulemenu li."+rcmail.env.crmModule+" a").trigger("click"),jQuery("#tplmenu  li a").on("click",function(){var e=jQuery(this).data("tplid"),t=rcmail.env.crmRecord,i=rcmail.env.crmModule;if("List"==rcmail.env.crmView){var l=jQuery(a.document).find(".listViewEntriesCheckBox")[0];t=jQuery(l).val()}jQuery.ajax({type:"Get",url:"?_task=mail&_action=plugin.yetiforce.getConntentEmailTemplate&_id="+rcmail.env.compose_id,data:{id:e,record_id:t,select_module:i},success:function(e){e=JSON.parse(e);var a=jQuery('[name="_subject"]').val(),t=jQuery("<div/>").html(e.content).html();if(jQuery('[name="_subject"]').val(a+" "+e.subject),window.tinyMCE&&(ed=tinyMCE.get(rcmail.env.composebody))){var i=tinyMCE.activeEditor.getContent();tinymce.activeEditor.setContent(t+i)}else{i=jQuery("#composebody").val();jQuery("#composebody").val(t+i)}void 0!==e.attachments&&null!==e.attachments&&rcmail.command("yetiforce.addFilesToMail",e.attachments)}})})});
//# sourceMappingURL=compose.min.js.map